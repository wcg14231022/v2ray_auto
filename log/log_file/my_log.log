log file2023-05-25 01:22:02,783 - log.my_log - INFO - 开始初始化环境信息
2023-05-25 01:22:02,783 - log.my_log - INFO - 初始化环境信息完成
2023-05-25 01:22:02,783 - log.my_log - INFO - 开始登录服务器
2023-05-25 01:22:06,848 - log.my_log - INFO - 登录服务器完成
2023-05-25 01:22:06,848 - log.my_log - INFO - 开始更新服务器
2023-05-25 01:22:07,971 - log.my_log - INFO - [188.166.225.29: 22]: pwd
/root

2023-05-25 01:22:09,041 - log.my_log - INFO - [188.166.225.29: 22]: cat /etc/os-release | grep -E "^ID="
ID="centos"

2023-05-25 01:22:09,041 - log.my_log - INFO - Linux操作系统类型: centos
2023-05-25 01:22:11,323 - log.my_log - INFO - [188.166.225.29: 22]: yum update -y
DigitalOcean Droplet Agent                       12 kB/s | 3.3 kB     00:00    
Dependencies resolved.
Nothing to do.
Complete!

2023-05-25 01:22:11,324 - log.my_log - INFO - 更新服务器完成
2023-05-25 01:22:11,324 - log.my_log - INFO - 开始自动安装Python
2023-05-25 01:22:13,344 - log.my_log - INFO - [188.166.225.29: 22]: yum install python3 -y
Last metadata expiration check: 0:00:02 ago on Wed 24 May 2023 05:22:10 PM UTC.
Package python3-3.9.16-1.el9.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!

2023-05-25 01:22:13,344 - log.my_log - INFO - 自动安装Python完成
2023-05-25 01:22:13,345 - log.my_log - INFO - 开始自动安装pip
2023-05-25 01:22:15,113 - log.my_log - INFO - [188.166.225.29: 22]: yum install python3-pip -y
Last metadata expiration check: 0:00:04 ago on Wed 24 May 2023 05:22:10 PM UTC.
Package python3-pip-21.2.3-6.el9.noarch is already installed.
Dependencies resolved.
Nothing to do.
Complete!

2023-05-25 01:22:15,113 - log.my_log - INFO - 自动安装pip完成
2023-05-25 01:22:15,113 - log.my_log - INFO - 开始安装git
2023-05-25 01:22:16,959 - log.my_log - INFO - [188.166.225.29: 22]: yum install git -y
Last metadata expiration check: 0:00:06 ago on Wed 24 May 2023 05:22:10 PM UTC.
Package git-2.39.1-1.el9.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!

2023-05-25 01:22:16,959 - log.my_log - INFO - 安装git完成
2023-05-25 01:22:16,959 - log.my_log - INFO - 开始克隆v2ray-auto代码
2023-05-25 01:22:18,033 - log.my_log - INFO - [188.166.225.29: 22]: mkdir -p /home/git_dir

2023-05-25 01:22:19,149 - log.my_log - INFO - [188.166.225.29: 22]: git clone https://github.com/wcg14231022/v2ray_auto.git /home/git_dir/v2ray_auto

2023-05-25 01:22:19,149 - log.my_log - INFO - [188.166.225.29: 22]:
Command error: fatal: destination path '/home/git_dir/v2ray_auto' already exists and is not an empty directory.

2023-05-25 01:22:19,149 - log.my_log - INFO - 克隆v2ray-auto代码完成
2023-05-25 01:22:19,149 - log.my_log - INFO - 开始安装python依赖
2023-05-25 01:22:20,944 - log.my_log - INFO - [188.166.225.29: 22]: pip install -r /home/git_dir/requirements.txt
Requirement already satisfied: Flask~=2.2.3 in /usr/local/lib/python3.9/site-packages (from -r /home/git_dir/requirements.txt (line 1)) (2.2.5)
Requirement already satisfied: requests~=2.28.2 in /usr/local/lib/python3.9/site-packages (from -r /home/git_dir/requirements.txt (line 2)) (2.28.2)
Requirement already satisfied: bs4~=0.0.1 in /usr/local/lib/python3.9/site-packages (from -r /home/git_dir/requirements.txt (line 3)) (0.0.1)
Requirement already satisfied: beautifulsoup4~=4.12.0 in /usr/local/lib/python3.9/site-packages (from -r /home/git_dir/requirements.txt (line 4)) (4.12.2)
Requirement already satisfied: distro~=1.8.0 in /usr/local/lib/python3.9/site-packages (from -r /home/git_dir/requirements.txt (line 5)) (1.8.0)
Requirement already satisfied: paramiko~=3.1.0 in /usr/local/lib/python3.9/site-packages (from -r /home/git_dir/requirements.txt (line 6)) (3.1.0)
Requirement already satisfied: Werkzeug>=2.2.2 in /usr/local/lib/python3.9/site-packages (from Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (2.3.4)
Requirement already satisfied: importlib-metadata>=3.6.0 in /usr/local/lib/python3.9/site-packages (from Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (6.6.0)
Requirement already satisfied: Jinja2>=3.0 in /usr/local/lib/python3.9/site-packages (from Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (3.1.2)
Requirement already satisfied: click>=8.0 in /usr/local/lib/python3.9/site-packages (from Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (8.1.3)
Requirement already satisfied: itsdangerous>=2.0 in /usr/local/lib/python3.9/site-packages (from Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (2.1.2)
Requirement already satisfied: idna<4,>=2.5 in /usr/lib/python3.9/site-packages (from requests~=2.28.2->-r /home/git_dir/requirements.txt (line 2)) (2.10)
Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.9/site-packages (from requests~=2.28.2->-r /home/git_dir/requirements.txt (line 2)) (2023.5.7)
Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib64/python3.9/site-packages (from requests~=2.28.2->-r /home/git_dir/requirements.txt (line 2)) (3.1.0)
Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/lib/python3.9/site-packages (from requests~=2.28.2->-r /home/git_dir/requirements.txt (line 2)) (1.26.5)
Requirement already satisfied: soupsieve>1.2 in /usr/local/lib/python3.9/site-packages (from beautifulsoup4~=4.12.0->-r /home/git_dir/requirements.txt (line 4)) (2.4.1)
Requirement already satisfied: cryptography>=3.3 in /usr/local/lib64/python3.9/site-packages (from paramiko~=3.1.0->-r /home/git_dir/requirements.txt (line 6)) (40.0.2)
Requirement already satisfied: bcrypt>=3.2 in /usr/local/lib64/python3.9/site-packages (from paramiko~=3.1.0->-r /home/git_dir/requirements.txt (line 6)) (4.0.1)
Requirement already satisfied: pynacl>=1.5 in /usr/local/lib64/python3.9/site-packages (from paramiko~=3.1.0->-r /home/git_dir/requirements.txt (line 6)) (1.5.0)
Requirement already satisfied: cffi>=1.12 in /usr/local/lib64/python3.9/site-packages (from cryptography>=3.3->paramiko~=3.1.0->-r /home/git_dir/requirements.txt (line 6)) (1.15.1)
Requirement already satisfied: pycparser in /usr/local/lib/python3.9/site-packages (from cffi>=1.12->cryptography>=3.3->paramiko~=3.1.0->-r /home/git_dir/requirements.txt (line 6)) (2.21)
Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.9/site-packages (from importlib-metadata>=3.6.0->Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (3.15.0)
Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib64/python3.9/site-packages (from Jinja2>=3.0->Flask~=2.2.3->-r /home/git_dir/requirements.txt (line 1)) (2.1.2)

2023-05-25 01:22:20,944 - log.my_log - INFO - [188.166.225.29: 22]:
Command error: WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv

2023-05-25 01:22:20,946 - log.my_log - INFO - 安装python依赖完成
2023-05-25 01:22:20,946 - log.my_log - INFO - 开始自动配置v2ray服务
2023-05-25 01:22:36,209 - log.my_log - INFO - [188.166.225.29: 22]: cd /home/git_dir/v2ray_auto && sudo python3 /home/git_dir/v2ray_auto/auto_install_v2ray.py
error: V2Ray is not installed.

info: Installing V2Ray v5.4.1 for x86_64
Downloading V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.4.1/v2ray-linux-64.zip
Downloading verification file for V2Ray archive: https://github.com/v2fly/v2ray-core/releases/download/v5.4.1/v2ray-linux-64.zip.dgst
Last metadata expiration check: 0:00:16 ago on Wed 24 May 2023 05:22:10 PM UTC.
Dependencies resolved.
================================================================================
 Package         Architecture     Version                Repository        Size
================================================================================
Installing:
 unzip           x86_64           6.0-56.el9             baseos           182 k

Transaction Summary
================================================================================
Install  1 Package

Total download size: 182 k
Installed size: 392 k
Downloading Packages:
unzip-6.0-56.el9.x86_64.rpm                     298 kB/s | 182 kB     00:00    
--------------------------------------------------------------------------------
Total                                           133 kB/s | 182 kB     00:01     
Running transaction check
Transaction check succeeded.
Running transaction test
Transaction test succeeded.
Running transaction
  Preparing        :                                                        1/1 
  Installing       : unzip-6.0-56.el9.x86_64                                1/1 
  Running scriptlet: unzip-6.0-56.el9.x86_64                                1/1 
  Verifying        : unzip-6.0-56.el9.x86_64                                1/1 

Installed:
  unzip-6.0-56.el9.x86_64                                                       

Complete!
info: unzip is installed.
info: Extract the V2Ray package to /tmp/tmp.vIhi6LZQDs and prepare it for installation.
info: Systemd service files have been installed successfully!
warning: The following are the actual parameters for the v2ray service startup.
warning: Please make sure the configuration file path is correctly set.
# /etc/systemd/system/v2ray.service
[Unit]
Description=V2Ray Service
Documentation=https://www.v2fly.org/
After=network.target nss-lookup.target

[Service]
User=nobody
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE
NoNewPrivileges=true
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json
Restart=on-failure
RestartPreventExitStatus=23

[Install]
WantedBy=multi-user.target

# /etc/systemd/system/v2ray.service.d/10-donot_touch_single_conf.conf
# In case you have a good reason to do so, duplicate this file in the same directory and make your customizes there.
# Or all changes you made will be lost!  # Refer: https://www.freedesktop.org/software/systemd/man/systemd.unit.html
[Service]
ExecStart=
ExecStart=/usr/local/bin/v2ray run -config /usr/local/etc/v2ray/config.json

installed: /usr/local/bin/v2ray
installed: /usr/local/share/v2ray/geoip.dat
installed: /usr/local/share/v2ray/geosite.dat
installed: /usr/local/etc/v2ray/config.json
installed: /var/log/v2ray/
installed: /var/log/v2ray/access.log
installed: /var/log/v2ray/error.log
installed: /etc/systemd/system/v2ray.service
installed: /etc/systemd/system/v2ray@.service
removed: /tmp/tmp.vIhi6LZQDs
info: V2Ray v5.4.1 is installed.
You may need to execute a command to remove dependent software: dnf remove curl unzip
Please execute the command: systemctl enable v2ray; systemctl start v2ray

start v2ray


start v2ray finished

2023-05-25 01:22:36,209 - log.my_log - INFO - [188.166.225.29: 22]:
Command error: 2023-05-24 17:22:22,121 - log.my_log - INFO - 开始自动安装V2Ray...
2023-05-24 17:22:22,121 - log.my_log - INFO - 生成的uuid: 8f8cd091-78a3-4ac8-9cd9-51556a49ecfd
2023-05-24 17:22:22,121 - log.my_log - INFO - 获取随机端口：
2023-05-24 17:22:22,121 - log.my_log - INFO - 随机端口为: 51734
2023-05-24 17:22:22,344 - log.my_log - INFO - 本机公网IP: 188.166.225.29
2023-05-24 17:22:31,555 - log.my_log - INFO - stop v2ray
2023-05-24 17:22:31,582 - log.my_log - INFO - 
2023-05-24 17:22:31,583 - log.my_log - INFO - stop v2ray finished
2023-05-24 17:22:31,583 - log.my_log - INFO - start v2ray
Created symlink /etc/systemd/system/multi-user.target.wants/v2ray.service → /etc/systemd/system/v2ray.service.
2023-05-24 17:22:32,210 - log.my_log - INFO - start v2ray finished
2023-05-24 17:22:32,215 - log.my_log - INFO - vmess_url: vmess://eyJ2IjogIjIiLCAicHMiOiAid2NnXzE4OC4xNjYuMjI1LjI5IiwgImFkZCI6ICIxODguMTY2LjIyNS4yOSIsICJwb3J0IjogNTE3MzQsICJpZCI6ICI4ZjhjZDA5MS03OGEzLTRhYzgtOWNkOS01MTU1NmE0OWVjZmQiLCAiYWlkIjogMCwgIm5ldCI6ICJ0Y3AiLCAidHlwZSI6ICJub25lIiwgImhvc3QiOiAiIiwgInBhdGgiOiAiIiwgInRscyI6ICIifQ==
2023-05-24 17:22:34,390 - log.my_log - INFO - 邮件发送成功
Created symlink /etc/systemd/system/multi-user.target.wants/my_ip_detect_service.service → /etc/systemd/system/my_ip_detect_service.service.

2023-05-25 01:22:36,210 - log.my_log - INFO - 自动配置v2ray服务完成
